<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo đề thi Văn học</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a89dc;
            --secondary-color: #e6f2ff;
            --accent-color: #3b7ddd;
            --text-color: #333;
            --light-color: #f8f9fa;
            --border-color: #dee2e6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            background-color: #f5f7fa;
        }
        
        .navbar {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 500;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(74, 137, 220, 0.25);
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 10px 10px;
            border: 1px solid var(--border-color);
            border-top: none;
        }
        
        .nav-tabs .nav-link {
            color: var(--text-color);
            border: none;
            padding: 12px 20px;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .nav-tabs .nav-link:hover:not(.active) {
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
        }
        
        .question-container {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }
        
        .preview-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            padding: 0 20px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 5px;
            border: 2px solid var(--primary-color);
        }
        
        .step.active .step-number {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-number {
            background-color: #5cb85c;
            border-color: #5cb85c;
            color: white;
        }
        
        .step-title {
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        .step.active .step-title {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .step.completed .step-title {
            color: #5cb85c;
        }
        
        .step-connector {
            position: absolute;
            top: 20px;
            left: -50%;
            width: 100%;
            height: 2px;
            background-color: var(--border-color);
            z-index: -1;
        }
        
        .step.active .step-connector, .step.completed .step-connector {
            background-color: var(--primary-color);
        }
        
        .step:first-child .step-connector {
            display: none;
        }
        
        .exam-code {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 20px 0;
        }
        
        .qr-code-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .share-link {
            background-color: var(--light-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .share-link input {
            border: none;
            background: transparent;
            flex-grow: 1;
        }
        
        .share-link button {
            background: none;
            border: none;
            color: var(--primary-color);
        }
        
        .camera-preview {
            width: 100%;
            height: 300px;
            background-color: #eee;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .camera-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            display: none;
            margin-bottom: 15px;
        }
        
        .ai-loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .ai-loading .spinner {
            margin-bottom: 10px;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-book-open me-2"></i>Văn Học Exam
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="fas fa-home me-1"></i> Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="create-exam.html"><i class="fas fa-plus-circle me-1"></i> Tạo đề</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="take-exam.html"><i class="fas fa-pen-alt me-1"></i> Thi thử</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="manage-exam.html"><i class="fas fa-clipboard-list me-1"></i> Quản lý</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html"><i class="fas fa-sign-in-alt me-1"></i> Đăng nhập</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Tạo đề thi mới</h4>
                    </div>
                    <div class="card-body">
                        <!-- Step Indicator -->
                        <div class="step-indicator">
                            <div class="step active" id="step1">
                                <div class="step-number">1</div>
                                <div class="step-title">Thiết lập cơ bản</div>
                                <div class="step-connector"></div>
                            </div>
                            <div class="step" id="step2">
                                <div class="step-number">2</div>
                                <div class="step-title">Tạo câu hỏi</div>
                                <div class="step-connector"></div>
                            </div>
                            <div class="step" id="step3">
                                <div class="step-number">3</div>
                                <div class="step-title">Cài đặt bảo mật</div>
                                <div class="step-connector"></div>
                            </div>
                            <div class="step" id="step4">
                                <div class="step-number">4</div>
                                <div class="step-title">Hoàn thành</div>
                            </div>
                        </div>

                        <!-- Step 1: Basic Setup -->
                        <div class="step-content" id="step1-content">
                            <h5 class="mb-4"><i class="fas fa-cog me-2"></i>Thiết lập cơ bản</h5>
                            <div class="mb-3">
                                <label for="examTitle" class="form-label">Tiêu đề đề thi</label>
                                <input type="text" class="form-control" id="examTitle" placeholder="Ví dụ: Đề thi học kỳ I môn Ngữ Văn 12">
                            </div>
                            <div class="mb-3">
                                <label for="examDescription" class="form-label">Mô tả đề thi</label>
                                <textarea class="form-control" id="examDescription" rows="3" placeholder="Mô tả ngắn gọn về đề thi"></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="examDuration" class="form-label">Thời gian làm bài (phút)</label>
                                    <input type="number" class="form-control" id="examDuration" min="1" value="60">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="examSubject" class="form-label">Môn học</label>
                                    <select class="form-select" id="examSubject">
                                        <option value="ngu_van">Ngữ Văn</option>
                                        <option value="van_hoc">Văn học</option>
                                        <option value="tieng_viet">Tiếng Việt</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="examGrade" class="form-label">Khối lớp</label>
                                <select class="form-select" id="examGrade">
                                    <option value="10">Lớp 10</option>
                                    <option value="11">Lớp 11</option>
                                    <option value="12" selected>Lớp 12</option>
                                    <option value="other">Khác</option>
                                </select>
                            </div>
                            <div class="d-flex justify-content-end mt-4">
                                <button class="btn btn-primary" id="nextToStep2">Tiếp theo <i class="fas fa-arrow-right ms-2"></i></button>
                            </div>
                        </div>

                        <!-- Step 2: Create Questions -->
                        <div class="step-content d-none" id="step2-content">
                            <h5 class="mb-4"><i class="fas fa-question-circle me-2"></i>Tạo câu hỏi</h5>
                            
                            <ul class="nav nav-tabs" id="questionMethodTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual" type="button" role="tab">Thủ công</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai" type="button" role="tab">AI Tạo đề</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="word-tab" data-bs-toggle="tab" data-bs-target="#word" type="button" role="tab">Nhập từ Word</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="image-tab" data-bs-toggle="tab" data-bs-target="#image" type="button" role="tab">Nhập từ ảnh</button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="questionMethodTabsContent">
                                <!-- Manual Tab -->
                                <div class="tab-pane fade show active" id="manual" role="tabpanel">
                                    <div class="d-flex justify-content-between align-items-center mb-3 mt-3">
                                        <h6><i class="fas fa-pen me-2"></i>Tạo câu hỏi thủ công</h6>
                                        <button class="btn btn-sm btn-primary" id="addQuestionBtn">
                                            <i class="fas fa-plus me-1"></i> Thêm câu hỏi
                                        </button>
                                    </div>
                                    
                                    <div id="questionsContainer">
                                        <!-- Questions will be added here -->
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-4">
                                        <button class="btn btn-outline-secondary" id="backToStep1">
                                            <i class="fas fa-arrow-left me-2"></i> Quay lại
                                        </button>
                                        <button class="btn btn-primary" id="nextToStep3">
                                            Tiếp theo <i class="fas fa-arrow-right ms-2"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- AI Tab -->
                                <div class="tab-pane fade" id="ai" role="tabpanel">
                                    <div class="mb-3 mt-3">
                                        <h6><i class="fas fa-robot me-2"></i>Tạo đề thi bằng AI</h6>
                                        <p class="text-muted">Nhập mô tả chi tiết về đề thi bạn muốn tạo, AI sẽ giúp bạn tạo đề thi tự động.</p>
                                        
                                        <label for="aiPrompt" class="form-label">Mô tả đề thi</label>
                                        <textarea class="form-control" id="aiPrompt" rows="5" placeholder="Ví dụ: Tạo đề thi học kỳ I môn Ngữ Văn 12 với 20 câu hỏi trắc nghiệm và 2 câu tự luận. Trọng tâm là tác phẩm 'Vợ chồng A Phủ' của Tô Hoài và 'Chiếc thuyền ngoài xa' của Nguyễn Minh Châu. Bao gồm các câu hỏi về tác giả, tác phẩm, phân tích nhân vật và nghệ thuật."></textarea>
                                        
                                        <div class="row mt-2">
                                            <div class="col-md-4">
                                                <label for="aiQuestionCount" class="form-label">Số lượng câu hỏi</label>
                                                <input type="number" class="form-control" id="aiQuestionCount" min="1" max="50" value="10">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="aiQuestionTypes" class="form-label">Loại câu hỏi</label>
                                                <select class="form-select" id="aiQuestionTypes" multiple>
                                                    <option value="multiple_choice" selected>Trắc nghiệm</option>
                                                    <option value="true_false">Đúng/Sai</option>
                                                    <option value="short_answer">Trả lời ngắn</option>
                                                    <option value="essay">Tự luận</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="aiDifficulty" class="form-label">Độ khó</label>
                                                <select class="form-select" id="aiDifficulty">
                                                    <option value="easy">Dễ</option>
                                                    <option value="medium" selected>Trung bình</option>
                                                    <option value="hard">Khó</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mt-4">
                                            <button class="btn btn-outline-secondary" id="backToStep1FromAI">
                                                <i class="fas fa-arrow-left me-2"></i> Quay lại
                                            </button>
                                            <button class="btn btn-primary" id="generateAIExam">
                                                <i class="fas fa-magic me-2"></i> Tạo đề bằng AI
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="ai-loading" id="aiLoading">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p>AI đang tạo đề thi cho bạn. Vui lòng chờ trong giây lát...</p>
                                    </div>
                                </div>
                                
                                <!-- Word Tab -->
                                <div class="tab-pane fade" id="word" role="tabpanel">
                                    <div class="mb-3 mt-3">
                                        <h6><i class="fas fa-file-word me-2"></i>Nhập đề thi từ file Word</h6>
                                        <p class="text-muted">Tải lên file Word (.docx) chứa đề thi, hệ thống sẽ tự động chuyển đổi thành đề thi trực tuyến.</p>
                                        
                                        <div class="mb-3">
                                            <label for="wordFile" class="form-label">Chọn file Word</label>
                                            <input class="form-control" type="file" id="wordFile" accept=".docx">
                                        </div>
                                        
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle me-2"></i>
                                            Để có kết quả tốt nhất, vui lòng sử dụng file Word có cấu trúc rõ ràng với các câu hỏi và đáp án được định dạng hợp lý.
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mt-4">
                                            <button class="btn btn-outline-secondary" id="backToStep1FromWord">
                                                <i class="fas fa-arrow-left me-2"></i> Quay lại
                                            </button>
                                            <button class="btn btn-primary" id="uploadWordFile">
                                                <i class="fas fa-upload me-2"></i> Tải lên và chuyển đổi
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Image Tab -->
                                <div class="tab-pane fade" id="image" role="tabpanel">
                                    <div class="mb-3 mt-3">
                                        <h6><i class="fas fa-image me-2"></i>Nhập đề thi từ hình ảnh</h6>
                                        <p class="text-muted">Tải lên hình ảnh chứa đề thi hoặc chụp ảnh trực tiếp từ camera, hệ thống sẽ sử dụng AI để nhận dạng và tạo đề thi.</p>
                                        
                                        <ul class="nav nav-tabs mb-3" id="imageSourceTabs" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">Tải lên ảnh</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="camera-tab" data-bs-toggle="tab" data-bs-target="#camera" type="button" role="tab">Chụp ảnh</button>
                                            </li>
                                        </ul>
                                        
                                        <div class="tab-content" id="imageSourceTabsContent">
                                            <div class="tab-pane fade show active" id="upload" role="tabpanel">
                                                <div class="mb-3">
                                                    <label for="imageFile" class="form-label">Chọn hình ảnh</label>
                                                    <input class="form-control" type="file" id="imageFile" accept="image/*">
                                                </div>
                                                
                                                <div class="alert alert-info">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    Hỗ trợ các định dạng ảnh: JPG, PNG, GIF. Để có kết quả tốt nhất, vui lòng sử dụng ảnh rõ nét, chữ viết không bị mờ.
                                                </div>
                                            </div>
                                            
                                            <div class="tab-pane fade" id="camera" role="tabpanel">
                                                <div class="camera-preview">
                                                    <div class="text-center text-muted">
                                                        <i class="fas fa-camera fa-3x mb-2"></i>
                                                        <p>Nhấn nút bên dưới để bật camera</p>
                                                    </div>
                                                    <video id="cameraFeed" autoplay playsinline style="display: none;"></video>
                                                </div>
                                                <img id="capturedImage" class="captured-image" alt="Ảnh đã chụp">
                                                
                                                <div class="camera-controls">
                                                    <button class="btn btn-primary" id="startCameraBtn">
                                                        <i class="fas fa-camera me-2"></i> Bật Camera
                                                    </button>
                                                    <button class="btn btn-success" id="captureBtn" style="display: none;">
                                                        <i class="fas fa-camera me-2"></i> Chụp ảnh
                                                    </button>
                                                    <button class="btn btn-danger" id="stopCameraBtn" style="display: none;">
                                                        <i class="fas fa-stop me-2"></i> Tắt Camera
                                                    </button>
                                                    <button class="btn btn-warning" id="retakeBtn" style="display: none;">
                                                        <i class="fas fa-redo me-2"></i> Chụp lại
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mt-4">
                                            <button class="btn btn-outline-secondary" id="backToStep1FromImage">
                                                <i class="fas fa-arrow-left me-2"></i> Quay lại
                                            </button>
                                            <button class="btn btn-primary" id="processImage">
                                                <i class="fas fa-eye me-2"></i> Nhận dạng đề thi
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Security Settings -->
                        <div class="step-content d-none" id="step3-content">
                            <h5 class="mb-4"><i class="fas fa-shield-alt me-2"></i>Cài đặt bảo mật</h5>
                            
                            <div class="mb-4">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="preventCopyPaste" checked>
                                    <label class="form-check-label" for="preventCopyPaste">Chống sao chép và dán nội dung</label>
                                    <small class="text-muted d-block">Ngăn thí sinh sao chép nội dung từ đề thi hoặc dán nội dung vào bài làm</small>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="preventTabSwitch" checked>
                                    <label class="form-check-label" for="preventTabSwitch">Chống chuyển tab/ứng dụng</label>
                                    <small class="text-muted d-block">Tự động nộp bài nếu thí sinh chuyển sang tab khác hoặc mở ứng dụng khác</small>
                                </div>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="enableFullscreen">
                                    <label class="form-check-label" for="enableFullscreen">Yêu cầu chế độ toàn màn hình</label>
                                    <small class="text-muted d-block">Thí sinh phải bật chế độ toàn màn hình để làm bài</small>
                                </div>
                                
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableMonitoring">
                                    <label class="form-check-label" for="enableMonitoring">Bật giám sát bằng camera (nếu có)</label>
                                    <small class="text-muted d-block">Yêu cầu quyền truy cập camera để giám sát thí sinh (tùy chọn)</small>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="examPassword" class="form-label">Mật khẩu truy cập (tùy chọn)</label>
                                <input type="password" class="form-control" id="examPassword" placeholder="Nhập mật khẩu nếu muốn bảo vệ đề thi">
                                <small class="text-muted">Thí sinh sẽ cần nhập mật khẩu này để truy cập đề thi</small>
                            </div>
                            
                            <div class="mb-4">
                                <label for="examAccess" class="form-label">Quyền truy cập</label>
                                <select class="form-select" id="examAccess">
                                    <option value="public">Công khai - Ai cũng có thể thi</option>
                                    <option value="private" selected>Riêng tư - Chỉ người có link/mã</option>
                                    <option value="restricted">Hạn chế - Chỉ người được mời</option>
                                </select>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button class="btn btn-outline-secondary" id="backToStep2">
                                    <i class="fas fa-arrow-left me-2"></i> Quay lại
                                </button>
                                <button class="btn btn-primary" id="nextToStep4">
                                    Tiếp theo <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 4: Completion -->
                        <div class="step-content d-none" id="step4-content">
                            <div class="text-center">
                                <div class="mb-4">
                                    <i class="fas fa-check-circle text-success fa-5x"></i>
                                    <h3 class="mt-3">Đề thi đã sẵn sàng!</h3>
                                    <p class="text-muted">Bạn có thể chia sẻ đề thi này với học sinh của mình</p>
                                </div>
                                
                                <div class="exam-code">
                                    <span>Mã đề thi: </span>
                                    <span id="generatedExamCode">VAN-5X7D9</span>
                                </div>
                                
                                <div class="qr-code-container">
                                    <canvas id="qrCodeCanvas" width="200" height="200"></canvas>
                                </div>
                                
                                <div class="share-link">
                                    <input type="text" id="examLink" value="https://vanhoc-exam.web.app/take-exam.html?code=VAN-5X7D9" readonly>
                                    <button id="copyLinkBtn">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                
                                <div class="share-buttons">
                                    <button class="share-btn btn btn-outline-primary">
                                        <i class="fab fa-facebook-f"></i> Facebook
                                    </button>
                                    <button class="share-btn btn btn-outline-info">
                                        <i class="fab fa-twitter"></i> Twitter
                                    </button>
                                    <button class="share-btn btn btn-outline-success">
                                        <i class="fab fa-whatsapp"></i> WhatsApp
                                    </button>
                                    <button class="share-btn btn btn-outline-secondary">
                                        <i class="fas fa-envelope"></i> Email
                                    </button>
                                </div>
                                
                                <div class="d-flex justify-content-center gap-3 mt-5">
                                    <button class="btn btn-outline-primary" id="viewExamBtn">
                                        <i class="fas fa-eye me-2"></i> Xem trước đề thi
                                    </button>
                                    <button class="btn btn-primary" id="finishBtn">
                                        <i class="fas fa-check me-2"></i> Hoàn thành
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container">
        <div class="toast align-items-center text-white bg-success" role="alert" aria-live="assertive" aria-atomic="true" id="successToast">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="successToastMessage">Thao tác thành công!</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        
        <div class="toast align-items-center text-white bg-danger" role="alert" aria-live="assertive" aria-atomic="true" id="errorToast">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span id="errorToastMessage">Đã xảy ra lỗi!</span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Question Template (hidden) -->
    <div class="d-none">
        <div class="question-template question-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Câu hỏi <span class="question-number">1</span></h6>
                <button class="btn btn-sm btn-danger delete-question-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Nội dung câu hỏi</label>
                <textarea class="form-control question-content" rows="3" placeholder="Nhập nội dung câu hỏi"></textarea>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Loại câu hỏi</label>
                <select class="form-select question-type">
                    <option value="multiple_choice">Trắc nghiệm (A, B, C, D)</option>
                    <option value="true_false">Đúng/Sai</option>
                    <option value="short_answer">Trả lời ngắn</option>
                    <option value="essay">Tự luận</option>
                </select>
            </div>
            
            <div class="question-options-container">
                <!-- Options for multiple choice -->
                <div class="multiple-choice-options">
                    <div class="mb-2">
                        <label class="form-label">Đáp án</label>
                        <div class="input-group mb-2">
                            <span class="input-group-text">A</span>
                            <input type="text" class="form-control option-a" placeholder="Đáp án A">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correctAnswer" value="A">
                            </div>
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">B</span>
                            <input type="text" class="form-control option-b" placeholder="Đáp án B">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correctAnswer" value="B">
                            </div>
                        </div>
                        <div class="input-group mb-2">
                            <span class="input-group-text">C</span>
                            <input type="text" class="form-control option-c" placeholder="Đáp án C">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correctAnswer" value="C">
                            </div>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text">D</span>
                            <input type="text" class="form-control option-d" placeholder="Đáp án D">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correctAnswer" value="D">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Options for true/false -->
                <div class="true-false-options d-none">
                    <div class="mb-2">
                        <label class="form-label">Đáp án đúng</label>
                        <div class="form-check">
                            <input class="form-check-input correct-answer" type="radio" name="correctAnswerTF" value="true">
                            <label class="form-check-label">Đúng</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input correct-answer" type="radio" name="correctAnswerTF" value="false">
                            <label class="form-check-label">Sai</label>
                        </div>
                    </div>
                </div>
                
                <!-- Options for short answer and essay -->
                <div class="text-answer-options d-none">
                    <div class="mb-2">
                        <label class="form-label">Đáp án mẫu (dành cho giáo viên)</label>
                        <textarea class="form-control model-answer" rows="3" placeholder="Nhập đáp án mẫu (không bắt buộc)"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="mt-3">
                <label class="form-label">Điểm số</label>
                <input type="number" class="form-control question-points" min="0" step="0.5" value="1">
            </div>
            
            <div class="mt-3">
                <label class="form-label">Gợi ý (tùy chọn)</label>
                <textarea class="form-control question-hint" rows="2" placeholder="Nhập gợi ý cho câu hỏi (nếu có)"></textarea>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD16Qh_b09HK2YPVslMkefDGhBSlkLqCLc",
            authDomain: "literatureexamapp.firebaseapp.com",
            projectId: "literatureexamapp",
            storageBucket: "literatureexamapp.appspot.com",
            messagingSenderId: "829681704033",
            appId: "1:829681704033:web:f92a79de0c177b235b9e20"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Initialize Gemini AI
        const geminiConfig = {
            apiKey: 'AIzaSyAn9dMMM5u8dEGpI8mEzQvdMSuI8KFH8jM',
            model: 'gemini-2.5-flash-preview-05-20'
        };

        // DOM Elements
        const step1Content = document.getElementById('step1-content');
        const step2Content = document.getElementById('step2-content');
        const step3Content = document.getElementById('step3-content');
        const step4Content = document.getElementById('step4-content');
        
        const step1Indicator = document.getElementById('step1');
        const step2Indicator = document.getElementById('step2');
        const step3Indicator = document.getElementById('step3');
        const step4Indicator = document.getElementById('step4');
        
        // Toast elements
        const successToast = new bootstrap.Toast(document.getElementById('successToast'));
        const errorToast = new bootstrap.Toast(document.getElementById('errorToast'));
        
        // Current exam data
        let examData = {
            title: '',
            description: '',
            duration: 60,
            subject: 'ngu_van',
            grade: '12',
            questions: [],
            security: {
                preventCopyPaste: true,
                preventTabSwitch: true,
                enableFullscreen: false,
                enableMonitoring: false,
                password: '',
                access: 'private'
            },
            createdAt: new Date(),
            createdBy: '',
            examCode: ''
        };
        
        // Generate a random exam code
        function generateExamCode() {
            const prefix = 'VAN-';
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            
            for (let i = 0; i < 5; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return prefix + code;
        }
        
        // Show success toast
        function showSuccess(message) {
            document.getElementById('successToastMessage').textContent = message;
            successToast.show();
        }
        
        // Show error toast
        function showError(message) {
            document.getElementById('errorToastMessage').textContent = message;
            errorToast.show();
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                if (!user) {
                    window.location.href = 'login.html';
                } else {
                    examData.createdBy = user.uid;
                }
            });
            
            // Step 1 to Step 2
            document.getElementById('nextToStep2').addEventListener('click', function() {
                const title = document.getElementById('examTitle').value.trim();
                const duration = parseInt(document.getElementById('examDuration').value);
                
                if (!title) {
                    showError('Vui lòng nhập tiêu đề đề thi');
                    return;
                }
                
                if (isNaN(duration) {
                    showError('Thời gian làm bài phải là số');
                    return;
                }
                
                examData.title = title;
                examData.description = document.getElementById('examDescription').value.trim();
                examData.duration = duration;
                examData.subject = document.getElementById('examSubject').value;
                examData.grade = document.getElementById('examGrade').value;
                
                // Move to step 2
                step1Content.classList.add('d-none');
                step2Content.classList.remove('d-none');
                
                step1Indicator.classList.remove('active');
                step1Indicator.classList.add('completed');
                step2Indicator.classList.add('active');
                
                showSuccess('Thiết lập cơ bản đã được lưu');
            });
            
            // Back from Step 2 to Step 1
            document.getElementById('backToStep1').addEventListener('click', backToStep1);
            document.getElementById('backToStep1FromAI').addEventListener('click', backToStep1);
            document.getElementById('backToStep1FromWord').addEventListener('click', backToStep1);
            document.getElementById('backToStep1FromImage').addEventListener('click', backToStep1);
            
            function backToStep1() {
                step2Content.classList.add('d-none');
                step1Content.classList.remove('d-none');
                
                step2Indicator.classList.remove('active');
                step1Indicator.classList.add('active');
                step1Indicator.classList.remove('completed');
            }
            
            // Step 2 to Step 3
            document.getElementById('nextToStep3').addEventListener('click', function() {
                // Validate questions
                const questions = collectQuestions();
                
                if (questions.length === 0) {
                    showError('Vui lòng thêm ít nhất một câu hỏi');
                    return;
                }
                
                examData.questions = questions;
                
                // Move to step 3
                step2Content.classList.add('d-none');
                step3Content.classList.remove('d-none');
                
                step2Indicator.classList.remove('active');
                step2Indicator.classList.add('completed');
                step3Indicator.classList.add('active');
                
                showSuccess('Câu hỏi đã được lưu');
            });
            
            // Back from Step 3 to Step 2
            document.getElementById('backToStep2').addEventListener('click', function() {
                // Save security settings
                examData.security.preventCopyPaste = document.getElementById('preventCopyPaste').checked;
                examData.security.preventTabSwitch = document.getElementById('preventTabSwitch').checked;
                examData.security.enableFullscreen = document.getElementById('enableFullscreen').checked;
                examData.security.enableMonitoring = document.getElementById('enableMonitoring').checked;
                examData.security.password = document.getElementById('examPassword').value;
                examData.security.access = document.getElementById('examAccess').value;
                
                // Move to step 2
                step3Content.classList.add('d-none');
                step2Content.classList.remove('d-none');
                
                step3Indicator.classList.remove('active');
                step2Indicator.classList.add('active');
                step2Indicator.classList.remove('completed');
            });
            
            // Step 3 to Step 4
            document.getElementById('nextToStep4').addEventListener('click', function() {
                // Save security settings
                examData.security.preventCopyPaste = document.getElementById('preventCopyPaste').checked;
                examData.security.preventTabSwitch = document.getElementById('preventTabSwitch').checked;
                examData.security.enableFullscreen = document.getElementById('enableFullscreen').checked;
                examData.security.enableMonitoring = document.getElementById('enableMonitoring').checked;
                examData.security.password = document.getElementById('examPassword').value;
                examData.security.access = document.getElementById('examAccess').value;
                
                // Generate exam code
                examData.examCode = generateExamCode();
                document.getElementById('generatedExamCode').textContent = examData.examCode;
                
                // Generate QR code
                const examLink = `https://${window.location.hostname}/take-exam.html?code=${examData.examCode}`;
                document.getElementById('examLink').value = examLink;
                
                new QRCode(document.getElementById('qrCodeCanvas'), {
                    text: examLink,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                // Move to step 4
                step3Content.classList.add('d-none');
                step4Content.classList.remove('d-none');
                
                step3Indicator.classList.remove('active');
                step3Indicator.classList.add('completed');
                step4Indicator.classList.add('active');
                
                showSuccess('Cài đặt bảo mật đã được lưu');
            });
            
            // Finish button - Save exam to Firestore
            document.getElementById('finishBtn').addEventListener('click', function() {
                // Save exam to Firestore
                db.collection('exams').doc(examData.examCode).set(examData)
                    .then(() => {
                        showSuccess('Đề thi đã được lưu thành công!');
                        setTimeout(() => {
                            window.location.href = 'manage-exam.html';
                        }, 2000);
                    })
                    .catch(error => {
                        console.error('Error saving exam: ', error);
                        showError('Lỗi khi lưu đề thi: ' + error.message);
                    });
            });
            
            // Copy link button
            document.getElementById('copyLinkBtn').addEventListener('click', function() {
                const examLink = document.getElementById('examLink');
                examLink.select();
                document.execCommand('copy');
                showSuccess('Đã sao chép link vào clipboard');
            });
            
            // Question type change handler
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('question-type')) {
                    const questionContainer = e.target.closest('.question-container');
                    const type = e.target.value;
                    
                    // Hide all option containers
                    questionContainer.querySelectorAll('.question-options-container > div').forEach(div => {
                        div.classList.add('d-none');
                    });
                    
                    // Show the appropriate option container
                    if (type === 'multiple_choice') {
                        questionContainer.querySelector('.multiple-choice-options').classList.remove('d-none');
                    } else if (type === 'true_false') {
                        questionContainer.querySelector('.true-false-options').classList.remove('d-none');
                    } else {
                        questionContainer.querySelector('.text-answer-options').classList.remove('d-none');
                    }
                }
            });
            
            // Add question button
            document.getElementById('addQuestionBtn').addEventListener('click', function() {
                addNewQuestion();
            });
            
            // Delete question button
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-question-btn') || e.target.closest('.delete-question-btn')) {
                    const questionContainer = e.target.closest('.question-container');
                    questionContainer.remove();
                    renumberQuestions();
                }
            });
            
            // Generate exam with AI
            document.getElementById('generateAIExam').addEventListener('click', function() {
                const prompt = document.getElementById('aiPrompt').value.trim();
                const questionCount = parseInt(document.getElementById('aiQuestionCount').value);
                const difficulty = document.getElementById('aiDifficulty').value;
                
                if (!prompt) {
                    showError('Vui lòng nhập mô tả đề thi');
                    return;
                }
                
                if (isNaN(questionCount) || questionCount < 1 || questionCount > 50) {
                    showError('Số lượng câu hỏi phải từ 1 đến 50');
                    return;
                }
                
                // Show loading indicator
                document.getElementById('aiLoading').style.display = 'block';
                
                // Simulate AI call (in a real app, you would call the Gemini API here)
                setTimeout(() => {
                    // Generate mock questions
                    const mockQuestions = generateMockQuestions(questionCount);
                    
                    // Clear existing questions
                    document.getElementById('questionsContainer').innerHTML = '';
                    
                    // Add generated questions
                    mockQuestions.forEach((q, index) => {
                        addNewQuestion(q, index + 1);
                    });
                    
                    // Hide loading indicator
                    document.getElementById('aiLoading').style.display = 'none';
                    
                    showSuccess(`Đã tạo thành công ${questionCount} câu hỏi bằng AI`);
                }, 2000);
            });
            
            // Camera functionality
            let stream = null;
            
            document.getElementById('startCameraBtn').addEventListener('click', function() {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then(function(mediaStream) {
                            stream = mediaStream;
                            const cameraFeed = document.getElementById('cameraFeed');
                            cameraFeed.srcObject = stream;
                            cameraFeed.style.display = 'block';
                            
                            // Hide placeholder and show controls
                            document.querySelector('.camera-preview > div').style.display = 'none';
                            document.getElementById('startCameraBtn').style.display = 'none';
                            document.getElementById('captureBtn').style.display = 'inline-block';
                            document.getElementById('stopCameraBtn').style.display = 'inline-block';
                        })
                        .catch(function(error) {
                            showError('Không thể truy cập camera: ' + error.message);
                        });
                } else {
                    showError('Trình duyệt không hỗ trợ truy cập camera');
                }
            });
            
            document.getElementById('stopCameraBtn').addEventListener('click', function() {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    document.getElementById('cameraFeed').style.display = 'none';
                    document.querySelector('.camera-preview > div').style.display = 'block';
                    document.getElementById('startCameraBtn').style.display = 'inline-block';
                    document.getElementById('captureBtn').style.display = 'none';
                    document.getElementById('stopCameraBtn').style.display = 'none';
                    document.getElementById('retakeBtn').style.display = 'none';
                    document.getElementById('capturedImage').style.display = 'none';
                    stream = null;
                }
            });
            
            document.getElementById('captureBtn').addEventListener('click', function() {
                const cameraFeed = document.getElementById('cameraFeed');
                const capturedImage = document.getElementById('capturedImage');
                
                const canvas = document.createElement('canvas');
                canvas.width = cameraFeed.videoWidth;
                canvas.height = cameraFeed.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(cameraFeed, 0, 0, canvas.width, canvas.height);
                
                capturedImage.src = canvas.toDataURL('image/png');
                capturedImage.style.display = 'block';
                
                document.getElementById('captureBtn').style.display = 'none';
                document.getElementById('retakeBtn').style.display = 'inline-block';
            });
            
            document.getElementById('retakeBtn').addEventListener('click', function() {
                document.getElementById('capturedImage').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'inline-block';
                document.getElementById('retakeBtn').style.display = 'none';
            });
            
            // Process image button
            document.getElementById('processImage').addEventListener('click', function() {
                let imageSrc = '';
                
                // Check if we're using camera or upload
                const activeTab = document.querySelector('#imageSourceTabs .nav-link.active').id;
                
                if (activeTab === 'upload-tab') {
                    const fileInput = document.getElementById('imageFile');
                    if (fileInput.files.length === 0) {
                        showError('Vui lòng chọn hình ảnh');
                        return;
                    }
                    
                    const file = fileInput.files[0];
                    if (!file.type.match('image.*')) {
                        showError('File phải là hình ảnh');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageSrc = e.target.result;
                        processImageWithAI(imageSrc);
                    };
                    reader.readAsDataURL(file);
                } else {
                    const capturedImage = document.getElementById('capturedImage');
                    if (capturedImage.style.display !== 'block') {
                        showError('Vui lòng chụp ảnh trước');
                        return;
                    }
                    
                    imageSrc = capturedImage.src;
                    processImageWithAI(imageSrc);
                }
            });
            
            // Upload Word file button
            document.getElementById('uploadWordFile').addEventListener('click', function() {
                const fileInput = document.getElementById('wordFile');
                if (fileInput.files.length === 0) {
                    showError('Vui lòng chọn file Word');
                    return;
                }
                
                const file = fileInput.files[0];
                if (!file.name.endsWith('.docx')) {
                    showError('File phải có định dạng .docx');
                    return;
                }
                
                // Simulate processing Word file
                showSuccess('Đang xử lý file Word... (mô phỏng)');
                
                setTimeout(() => {
                    // Generate mock questions from Word
                    const mockQuestions = generateMockQuestions(10);
                    
                    // Clear existing questions
                    document.getElementById('questionsContainer').innerHTML = '';
                    
                    // Add generated questions
                    mockQuestions.forEach((q, index) => {
                        addNewQuestion(q, index + 1);
                    });
                    
                    showSuccess('Đã tạo đề thi từ file Word thành công');
                }, 3000);
            });
            
            // View exam button
            document.getElementById('viewExamBtn').addEventListener('click', function() {
                // In a real app, you would open a preview window
                showSuccess('Chức năng xem trước đang được phát triển');
            });
            
            // Initialize first question
            addNewQuestion();
        });
        
        // Add a new question to the container
        function addNewQuestion(questionData = null, number = null) {
            const template = document.querySelector('.question-template').cloneNode(true);
            template.classList.remove('question-template', 'd-none');
            
            const questionsContainer = document.getElementById('questionsContainer');
            const questionCount = questionsContainer.querySelectorAll('.question-container').length;
            const questionNumber = number || questionCount + 1;
            
            template.querySelector('.question-number').textContent = questionNumber;
            questionsContainer.appendChild(template);
            
            // If questionData is provided, populate the fields
            if (questionData) {
                template.querySelector('.question-content').value = questionData.content;
                template.querySelector('.question-type').value = questionData.type;
                template.querySelector('.question-points').value = questionData.points;
                
                if (questionData.hint) {
                    template.querySelector('.question-hint').value = questionData.hint;
                }
                
                // Trigger change event to show correct options
                const event = new Event('change');
                template.querySelector('.question-type').dispatchEvent(event);
                
                // Set options based on type
                if (questionData.type === 'multiple_choice') {
                    template.querySelector('.option-a').value = questionData.options.A;
                    template.querySelector('.option-b').value = questionData.options.B;
                    template.querySelector('.option-c').value = questionData.options.C;
                    template.querySelector('.option-d').value = questionData.options.D;
                    
                    // Set correct answer
                    const correctAnswer = questionData.correctAnswer;
                    template.querySelector(`.correct-answer[value="${correctAnswer}"]`).checked = true;
                } else if (questionData.type === 'true_false') {
                    template.querySelector(`.correct-answer[value="${questionData.correctAnswer}"]`).checked = true;
                } else if (questionData.modelAnswer) {
                    template.querySelector('.model-answer').value = questionData.modelAnswer;
                }
            }
        }
        
        // Renumber questions after deletion
        function renumberQuestions() {
            const questions = document.querySelectorAll('#questionsContainer .question-container');
            questions.forEach((question, index) => {
                question.querySelector('.question-number').textContent = index + 1;
            });
        }
        
        // Collect all questions from the form
        function collectQuestions() {
            const questions = [];
            const questionContainers = document.querySelectorAll('#questionsContainer .question-container');
            
            questionContainers.forEach(container => {
                const type = container.querySelector('.question-type').value;
                const content = container.querySelector('.question-content').value.trim();
                const points = parseFloat(container.querySelector('.question-points').value);
                const hint = container.querySelector('.question-hint').value.trim();
                
                if (!content) return; // Skip empty questions
                
                const question = {
                    type,
                    content,
                    points: isNaN(points) ? 1 : points,
                    hint: hint || undefined
                };
                
                if (type === 'multiple_choice') {
                    question.options = {
                        A: container.querySelector('.option-a').value.trim(),
                        B: container.querySelector('.option-b').value.trim(),
                        C: container.querySelector('.option-c').value.trim(),
                        D: container.querySelector('.option-d').value.trim()
                    };
                    
                    const correctAnswer = container.querySelector('.correct-answer:checked');
                    question.correctAnswer = correctAnswer ? correctAnswer.value : 'A';
                } else if (type === 'true_false') {
                    const correctAnswer = container.querySelector('.correct-answer:checked');
                    question.correctAnswer = correctAnswer ? correctAnswer.value : 'true';
                } else {
                    const modelAnswer = container.querySelector('.model-answer').value.trim();
                    if (modelAnswer) {
                        question.modelAnswer = modelAnswer;
                    }
                }
                
                questions.push(question);
            });
            
            return questions;
        }
        
        // Generate mock questions for demo purposes
        function generateMockQuestions(count) {
            const mockQuestions = [];
            const literatureTopics = [
                "Tác phẩm 'Vợ chồng A Phủ' của Tô Hoài",
                "Truyện ngắn 'Chiếc thuyền ngoài xa' của Nguyễn Minh Châu",
                "Bài thơ 'Sóng' của Xuân Quỳnh",
                "Tác phẩm 'Chí Phèo' của Nam Cao",
                "Truyện 'Hai đứa trẻ' của Thạch Lam",
                "Bài thơ 'Đây thôn Vĩ Dạ' của Hàn Mặc Tử",
                "Tác phẩm 'Rừng xà nu' của Nguyễn Trung Thành",
                "Truyện 'Vợ nhặt' của Kim Lân",
                "Bài thơ 'Việt Bắc' của Tố Hữu",
                "Tác phẩm 'Người lái đò sông Đà' của Nguyễn Tuân"
            ];
            
            for (let i = 0; i < count; i++) {
                const topic = literatureTopics[Math.floor(Math.random() * literatureTopics.length)];
                const type = i % 4 === 0 ? 'multiple_choice' : 
                            i % 4 === 1 ? 'true_false' : 
                            i % 4 === 2 ? 'short_answer' : 'essay';
                
                const question = {
                    type,
                    content: `Câu hỏi về ${topic}: ${getQuestionContent(type, topic)}`,
                    points: Math.floor(Math.random() * 3) + 1,
                    hint: i % 3 === 0 ? `Gợi ý: Xem lại tác phẩm ${topic.split("'")[1] || topic}` : undefined
                };
                
                if (type === 'multiple_choice') {
                    question.options = {
                        A: getRandomOption(topic, 'A'),
                        B: getRandomOption(topic, 'B'),
                        C: getRandomOption(topic, 'C'),
                        D: getRandomOption(topic, 'D')
                    };
                    question.correctAnswer = ['A', 'B', 'C', 'D'][Math.floor(Math.random() * 4)];
                } else if (type === 'true_false') {
                    question.correctAnswer = Math.random() > 0.5 ? 'true' : 'false';
                } else {
                    question.modelAnswer = getModelAnswer(topic);
                }
                
                mockQuestions.push(question);
            }
            
            return mockQuestions;
        }
        
        function getQuestionContent(type, topic) {
            if (type === 'multiple_choice') {
                const questions = [
                    `Tác giả của ${topic} là ai?`,
                    `Nội dung chính của ${topic} là gì?`,
                    `Nhân vật chính trong ${topic} là ai?`,
                    `Bối cảnh của ${topic} diễn ra ở đâu?`
                ];
                return questions[Math.floor(Math.random() * questions.length)];
            } else if (type === 'true_false') {
                const statements = [
                    `${topic} được sáng tác trong thời kỳ kháng chiến chống Mỹ.`,
                    `Nhân vật chính trong ${topic} là người nông dân.`,
                    `${topic} thuộc thể loại truyện ngắn.`,
                    `Tác phẩm ${topic} được viết theo bút pháp hiện thực.`
                ];
                return statements[Math.floor(Math.random() * statements.length)];
            } else {
                const prompts = [
                    `Phân tích nhân vật chính trong ${topic}.`,
                    `Nêu cảm nhận của em về ${topic}.`,
                    `Trình bày giá trị nghệ thuật của ${topic}.`,
                    `Phân tích một đoạn văn tiêu biểu trong ${topic}.`
                ];
                return prompts[Math.floor(Math.random() * prompts.length)];
            }
        }
        
        function getRandomOption(topic, option) {
            const authors = ["Tô Hoài", "Nguyễn Minh Châu", "Xuân Quỳnh", "Nam Cao", "Thạch Lam", "Hàn Mặc Tử", "Nguyễn Trung Thành", "Kim Lân", "Tố Hữu", "Nguyễn Tuân"];
            const places = ["Tây Bắc", "Huế", "Hà Nội", "Nông thôn Việt Nam", "Miền núi", "Đồng bằng", "Thành phố", "Làng quê"];
            const characters = ["Mị", "A Phủ", "Người đàn bà hàng chài", "Phùng", "Chí Phèo", "Thị Nở", "Liên", "Anh", "Người lái đò"];
            
            const randomOption = [
                authors[Math.floor(Math.random() * authors.length)],
                places[Math.floor(Math.random() * places.length)],
                characters[Math.floor(Math.random() * characters.length)],
                "Tất cả các đáp án trên"
            ][Math.floor(Math.random() * 4)];
            
            return randomOption;
        }
        
        function getModelAnswer(topic) {
            const answers = [
                `${topic} là một tác phẩm xuất sắc trong nền văn học Việt Nam hiện đại. Tác phẩm này đã khắc họa thành công...`,
                `Nhân vật chính trong ${topic} là hình tượng tiêu biểu cho... Tác giả đã sử dụng nghệ thuật miêu tả tâm lý nhân vật rất tinh tế...`,
                `Giá trị nhân đạo của ${topic} thể hiện qua... Tác phẩm đã lên án những bất công trong xã hội và đồng cảm với số phận...`,
                `Nghệ thuật kể chuyện trong ${topic} rất độc đáo với... Tác giả sử dụng ngôn ngữ giản dị nhưng giàu hình ảnh và cảm xúc...`
            ];
            
            return answers[Math.floor(Math.random() * answers.length)];
        }
        
        // Process image with AI (simulated)
        function processImageWithAI(imageSrc) {
            showSuccess('Đang sử dụng AI để nhận dạng đề thi từ ảnh... (mô phỏng)');
            
            setTimeout(() => {
                // Generate mock questions from image
                const mockQuestions = generateMockQuestions(8);
                
                // Clear existing questions
                document.getElementById('questionsContainer').innerHTML = '';
                
                // Add generated questions
                mockQuestions.forEach((q, index) => {
                    addNewQuestion(q, index + 1);
                });
                
                showSuccess('Đã tạo đề thi từ ảnh thành công');
            }, 3000);
        }
    </script>
</body>
</html>
